<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evently Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="flex h-screen">
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="flex justify-between items-center p-6 bg-white border-b border-gray-200">
                <div class="flex items-center space-x-8">
                    <a href="#" class="flex items-center space-x-2">
                        <svg class="h-7 w-7 text-gray-800" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                        <span class="text-xl font-bold text-gray-900">Evently</span>
                    </a>
                    <nav class="hidden md:flex items-center space-x-6 text-sm font-medium text-gray-600">
                        <a href="#" class="text-gray-900">Dashboard</a>
                        <a href="#" class="hover:text-gray-900">Sponsorships</a>
                        <a href="#" class="hover:text-gray-900">Events</a>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <img class="h-10 w-10 rounded-full" src="https://i.pravatar.cc/150?img=1" alt="User Avatar">
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6 md:p-8">
                <div class="max-w-7xl mx-auto">
                    
                    <h2 id="welcome-message" class="text-3xl font-bold text-gray-900 mb-6">Dashboard Overview</h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gray-100 p-6 rounded-xl">
                            <p class="text-sm text-gray-600">Proposals Sent</p>
                            <p id="proposals-sent-stat" class="text-3xl font-semibold text-gray-900">0</p>
                        </div>
                        <div class="bg-gray-100 p-6 rounded-xl">
                            <p class="text-sm text-gray-600">Accepted Sponsorships</p>
                            <p id="accepted-sponsorships-stat" class="text-3xl font-semibold text-gray-900">0</p>
                        </div>
                        <div class="bg-gray-100 p-6 rounded-xl">
                            <p class="text-sm text-gray-600">Upcoming Events</p>
                            <p id="upcoming-events-stat" class="text-3xl font-semibold text-gray-900">0</p>
                        </div>
                        <div class="bg-gray-100 p-6 rounded-xl">
                            <p class="text-sm text-gray-600">Revenue Generated</p>
                            <p id="revenue-stat" class="text-3xl font-semibold text-gray-900">$0</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4 my-8">
                        <button class="bg-gray-200 text-gray-800 font-medium py-2 px-5 rounded-lg text-sm" id="eventListings">Event Listings</button>
                        <button class="bg-gray-200 text-gray-800 font-medium py-2 px-5 rounded-lg text-sm" id="sponsorPackage">Sponsorship Packages</button>
                        <button class="bg-gray-200 text-gray-800 font-medium py-2 px-5 rounded-lg text-sm" id="eventCalendar">Event Calendar</button>
                    </div>

                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Sponsorship Trends</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                             <div class="h-56"><canvas id="sponsorshipGrowthChart"></canvas></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                             <div class="h-56"><canvas id="revenueByTypeChart"></canvas></div>
                        </div>
                    </div>

                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Your Upcoming Sponsored Events</h3>
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-50 text-xs text-gray-600 uppercase">
                                <tr>
                                    <th scope="col" class="px-6 py-4 font-medium">Event Name</th>
                                    <th scope="col" class="px-6 py-4 font-medium">Date</th>
                                    <th scope="col" class="px-6 py-4 font-medium">Location</th>
                                    <th scope="col" class="px-6 py-4 font-medium">Proposal Status</th>
                                </tr>
                            </thead>
                            <tbody id="events-table-body" class="divide-y divide-gray-200">
                                </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- NAVIGATION ---
    document.querySelector('#eventListings').addEventListener('click', function() {
        window.location.href = "./sponsor-events-listing.html";
    });
    document.querySelector('#sponsorPackage').addEventListener('click', function() {
        window.location.href = './sponsor-packages.html';
    });
    document.querySelector('#eventCalendar').addEventListener('click', function() {
        window.location.href = './sponsor-event-calendar.html';
    });

    // --- DYNAMIC DATA ---
    const welcomeMessageEl = document.getElementById('welcome-message');
    const proposalsSentEl = document.getElementById('proposals-sent-stat');
    const acceptedSponsorshipsEl = document.getElementById('accepted-sponsorships-stat');
    const upcomingEventsEl = document.getElementById('upcoming-events-stat');
    const revenueEl = document.getElementById('revenue-stat');
    const tableBody = document.getElementById('events-table-body');

    fetch('http://localhost/event-management-backend/sponsors/get_sponsor_dashboard_data.php', {
        credentials: 'include'
    })
    .then(response => {
        if (!response.ok) {
            window.location.href = '../login-page.html';
            throw new Error('Authentication required.');
        }
        return response.json();
    })
    .then(data => {
        welcomeMessageEl.textContent = `Welcome, ${data.sponsor_name}`;
        // Connect to new backend data points
        proposalsSentEl.textContent = data.stats.proposals_sent;
        acceptedSponsorshipsEl.textContent = data.stats.accepted_sponsorships;
        upcomingEventsEl.textContent = data.stats.upcoming_events_count;
        revenueEl.textContent = `$${data.stats.revenue_generated.toLocaleString('en-US')}`;
        renderEventsTable(data.upcoming_events_list);
    })
    .catch(error => {
        console.error('Error fetching dashboard data:', error);
    });

    function renderEventsTable(events) {
        tableBody.innerHTML = '';
        if (events.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-gray-500">You have no upcoming sponsored events.</td></tr>`;
            return;
        }
        const statusColors = {
            pending: 'bg-yellow-100 text-yellow-800',
            accepted: 'bg-green-100 text-green-800',
            rejected: 'bg-red-100 text-red-800'
        };
        events.forEach(event => {
            const formattedDate = new Date(event.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const statusColor = statusColors[event.status] || 'bg-gray-100 text-gray-800';
            const statusText = event.status.charAt(0).toUpperCase() + event.status.slice(1);
            const row = `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${event.title}</td>
                    <td class="px-6 py-4">${formattedDate}</td>
                    <td class="px-6 py-4">${event.location}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-3 py-1 text-xs font-medium rounded-full ${statusColor}">${statusText}</span>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // --- CHART.JS ---
    const growthCtx = document.getElementById('sponsorshipGrowthChart').getContext('2d');
    new Chart(growthCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
                label: 'Sponsorships',
                data: [65, 59, 80, 81, 56, 95, 70],
                fill: false, borderColor: '#9ca3af', tension: 0.4, pointRadius: 0
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
            scales: {
                x: { grid: { display: false }, border: { display: false } },
                y: { grid: { display: false }, ticks: { display: false }, border: { display: false } }
            }
        }
    });
    const revenueCtx = document.getElementById('revenueByTypeChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'bar',
        data: {
            labels: ['Type A', 'Type B', 'Type C', 'Type D'],
            datasets: [{
                label: 'Revenue',
                data: [85, 65, 90, 75],
                backgroundColor: '#e5e7eb', borderRadius: 4, barPercentage: 0.5
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                x: { grid: { display: false }, border: { display: false } },
                y: { beginAtZero: true, grid: { display: false }, ticks: { display: false }, border: { display: false } }
            }
        }
    });
});
</script>

</body>
</html>