<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Profile - Evently</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://rsms.me/inter/inter.css');
        html { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">

    <header class="bg-white border-b border-slate-200">
        <!-- You can copy a header from another page like ticket-buyer-dashboard.html -->
    </header>

    <main class="mx-auto max-w-4xl px-6 py-12 lg:px-8">
        <h1 class="text-3xl font-bold tracking-tight text-slate-900">Your Profile</h1>
        
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Sidebar/Menu -->
            <div class="md:col-span-1">
                <nav class="space-y-1">
                    <a href="#" id="profile-tab" data-target="profile-section" class="tab-link bg-gray-200 text-gray-900 group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        Profile Information
                    </a>
                    <a href="#" id="password-tab" data-target="password-section" class="tab-link text-gray-600 hover:bg-gray-100 group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        Password
                    </a>
                </nav>
            </div>

            <!-- Right Content Area -->
            <div class="md:col-span-2 space-y-6">
                <!-- Profile Form Section -->
                <div id="profile-section" class="tab-content bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Profile Information</h2>
                    <p class="mt-1 text-sm text-gray-500">Update your personal details here.</p>
                    <form id="profile-form" class="mt-6 space-y-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                            <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div class="flex justify-end pt-4">
                            <button type="submit" class="rounded-lg bg-blue-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Password Change Form Section (Initially Hidden) -->
                <div id="password-section" class="tab-content hidden bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Change Password</h2>
                    <p class="mt-1 text-sm text-gray-500">Update your password. Please enter your current password to continue.</p>
                    <form id="password-form" class="mt-6 space-y-6">
                        <div>
                            <label for="current_password" class="block text-sm font-medium text-gray-700">Current Password</label>
                            <input type="password" id="current_password" name="current_password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="new_password" class="block text-sm font-medium text-gray-700">New Password</label>
                            <input type="password" id="new_password" name="new_password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                         <div>
                            <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                            <input type="password" id="confirm_password" name="confirm_password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div class="flex justify-end pt-4">
                            <button type="submit" class="rounded-lg bg-blue-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700">
                                Change Password
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Logout Button -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                     <h2 class="text-xl font-semibold text-gray-900">Logout</h2>
                     <p class="mt-1 text-sm text-gray-500">Log out of your Evently account.</p>
                     <div class="flex justify-end pt-4">
                        <button id="logout-btn" class="rounded-lg bg-red-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-red-700">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- FORM AND BUTTON ELEMENTS ---
    const profileForm = document.getElementById('profile-form');
    const passwordForm = document.getElementById('password-form');
    const logoutBtn = document.getElementById('logout-btn');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');

    // --- TAB SWITCHING LOGIC ---
    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = tab.dataset.target;
            
            // Update tab styles
            tabs.forEach(t => {
                t.classList.remove('bg-gray-200', 'text-gray-900');
                t.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            tab.classList.add('bg-gray-200', 'text-gray-900');
            tab.classList.remove('text-gray-600', 'hover:bg-gray-100');

            // Show/hide content
            tabContents.forEach(content => {
                if (content.id === targetId) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        });
    });

    // --- FETCH AND POPULATE PROFILE DATA ---
    fetch('http://localhost/event-management-backend/user/get_profile.php', { credentials: 'include' })
        .then(response => {
            if (!response.ok) { window.location.href = './login-page.html'; throw new Error('Not logged in'); }
            return response.json();
        })
        .then(data => {
            nameInput.value = data.name;
            emailInput.value = data.email;
        })
        .catch(error => console.error('Error fetching profile:', error));

    // --- HANDLE PROFILE UPDATE ---
    profileForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const updatedData = { name: nameInput.value, email: emailInput.value };
        fetch('http://localhost/event-management-backend/user/update_profile.php', {
            method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) { alert(data.message); } 
            else { alert(`Error: ${data.error}`); }
        })
        .catch(error => alert('An error occurred. Please try again.'));
    });
    
    // --- HANDLE PASSWORD CHANGE ---
    passwordForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(passwordForm);
        const data = Object.fromEntries(formData.entries());

        fetch('http://localhost/event-management-backend/user/change_password.php', {
            method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.message) {
                alert(result.message);
                passwordForm.reset(); // Clear form on success
            } else {
                alert(`Error: ${result.error}`);
            }
        })
        .catch(error => alert('An error occurred. Please try again.'));
    });

    // --- HANDLE LOGOUT ---
    logoutBtn.addEventListener('click', () => {
        fetch('http://localhost/event-management-backend/auth/logout.php', {
            method: 'POST', credentials: 'include'
        })
        .then(() => { window.location.href = './login-page.html'; })
        .catch(error => console.error('Logout failed:', error));
    });
});
</script>
</body>
</html>
