<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Evently</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://rsms.me/inter/inter.css');
        html { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-white">

    <header class="bg-white border-b border-slate-200">
        <div class="mx-auto flex h-20 max-w-full items-center justify-between px-6 lg:px-8">
            <div class="flex items-center gap-12">
                <a href="#f" class="flex items-center space-x-2">
                    <svg class="h-7 w-7 text-gray-800" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <span class="text-xl font-bold text-gray-900">Evently</span>
                </a>
            </div>
            <div class="flex items-center gap-8">
                <nav class="hidden items-center gap-8 md:flex">
    <!-- <a href="#" class="text-sm font-medium text-slate-600 hover:text-slate-900">Events</a> -->
    <div class="relative">
        <a href="./organizer-sponsorships.html" class="text-sm font-medium text-slate-600 hover:text-slate-900">Sponsors</a>
        <span id="sponsorship-notification-badge" 
              class="absolute top-2 right-0 ml-12 flex h-5 w-5 items-center justify-center rounded-full bg-red-600 text-xs font-bold text-white -translate-y-1/2 translate-x-1/2">
        </span>
    </div>
    <a href="./organizer-analytics.html" class="text-sm font-medium text-slate-600 hover:text-slate-900">Analytics</a>
    <a href="../ticket-buyer/ticket-buyer-dashboard.html" class="text-sm font-medium text-slate-600 hover:text-slate-900">Buy Ticket</a>
</nav>
                <div class="flex items-center gap-5">
                     <a href="../general/profile.html">
    <img id="header-profile-picture" 
         class="h-9 w-9 rounded-full object-cover" 
         src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2EwYTBiMyI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgM2MxLjY2IDAgMyAxLjM0IDMgMyAwIDEuNjYtMS4zNCAzLTMgMy0xLjY2IDAtMy0xLjM0LTMtMyAwLTEuNjYgMS4zNC0zIDMtM3ptMCAxNC4yYy0yLjUgMC00LjcxLTEuMjgtNi0zLjIyLjAzLTEuOTkgNC0zLjA4IDYtMy4wOHM1Ljk3IDEuMDkgNiAzLjA4Yy0xLjI5IDEuOTQtMy41IDMuMjItNiAzLjIyeiIvPjwvc3ZnPg==" 
         alt="User avatar" />
</a>
                </div>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-7xl px-6 py-10 lg:px-8">
        <h1 class="text-3xl font-bold tracking-tight text-slate-900">Welcome back, Sarah</h1>

        <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
            <div class="rounded-lg bg-slate-100 p-6">
                <p class="text-sm font-medium text-slate-600">Total Events</p>
                <p id="total-events-stat" class="mt-2 text-4xl font-bold text-slate-900">0</p>
            </div>
            <div class="rounded-lg bg-slate-100 p-6">
                <p class="text-sm font-medium text-slate-600">Tickets Sold</p>
                <p id="tickets-sold-stat" class="mt-2 text-4xl font-bold text-slate-900">0</p>
            </div>
            <div class="rounded-lg bg-slate-100 p-6">
                <p class="text-sm font-medium text-slate-600">Revenue</p>
                <p id="revenue-stat" class="mt-2 text-4xl font-bold text-slate-900">$0</p>
            </div>
            <div class="rounded-lg bg-slate-100 p-6">
                <p class="text-sm font-medium text-slate-600">Sponsors</p>
                <p id="sponsors-stat" class="mt-2 text-4xl font-bold text-slate-900">0</p>
            </div>
        </div>

        <section class="mt-12">
            <h2 class="text-xl font-semibold leading-7 text-slate-900">Your Events</h2>
            <div class="mt-4 flow-root">
                <div class="-mx-6 -my-2 overflow-x-auto lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                        <div class="overflow-hidden rounded-lg border border-slate-200">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-white">
                                    <tr>
                                        <th scope="col" class="py-3.5 pl-6 pr-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Event Name</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Date</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Tickets Sold</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Revenue</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Sponsor Status</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-slate-500">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200 bg-white" id="events-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="mt-6 flex justify-end">
            <button type="button" class="rounded-lg bg-blue-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700" id="createEvent">Create New Event</button>
        </div>
    </main>
    <footer class="bg-slate-100 text-slate-700 mt-16">
  <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 md:grid-cols-4 gap-8">

    <!-- Branding -->
    <div>
      <h2 class="text-xl font-bold text-slate-900 mb-2">Evently</h2>
      <p class="text-sm">Connecting you to events that matter.</p>
    </div>

    <!-- Contact Information -->
    <div>
      <h3 class="text-sm font-semibold text-slate-900 mb-2">Contact</h3>
      <p class="text-sm">üìß support@evently.com</p>
      <p class="text-sm">üìû +91 98765 43210</p>
      <p class="text-sm">üìç Mumbai, India</p>
    </div>

    <!-- Event Categories -->
    <div>
      <h3 class="text-sm font-semibold text-slate-900 mb-2">Know More About Us</h3>
      <ul class="space-y-1 text-sm">
        <li><a href="#" class="hover:text-blue-600">Privacy Policy</a></li>
        <li><a href="#" class="hover:text-blue-600">Terms & Conditions</a></li>
        <li><a href="#" class="hover:text-blue-600">Cookie Policy</a></li>
      </ul>
    </div>

    <!-- Our Socials (Moved from below) -->
    <div>
        <h3 class="text-sm font-semibold text-slate-900 mb-2">Our Socials</h3>
        <div class="flex space-x-4">
            <!-- Facebook -->
            <a href="#" class="hover:text-blue-600">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.877v-6.987h-2.54v-2.89h2.54V9.845c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.242 0-1.63.771-1.63 1.562v1.875h2.773l-.443 2.89h-2.33v6.987C18.343 21.128 22 16.991 22 12z"/>
                </svg>
            </a>
            <!-- Instagram -->
            <a href="#" class="hover:text-pink-500">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5a4.25 4.25 0 0 0 4.25-4.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5zm8.75 2a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z"/>
                </svg>
            </a>
            <!-- LinkedIn -->
            <a href="#" class="hover:text-blue-700">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20.447 20.452H16.89v-5.568c0-1.327-.027-3.036-1.85-3.036-1.851 0-2.136 1.445-2.136 2.939v5.665H9.348V9h3.409v1.561h.048c.476-.9 1.637-1.85 3.37-1.85 3.6 0 4.267 2.369 4.267 5.455v6.286zM5.337 7.433a1.992 1.992 0 1 1 0-3.984 1.992 1.992 0 0 1 0 3.984zM6.896 20.452H3.778V9h3.118v11.452z"/>
                </svg>
            </a>
            <!-- GitHub -->
            <a href="#" class="hover:text-gray-800">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 .5a12 12 0 0 0-3.792 23.39c.6.113.82-.26.82-.577 0-.285-.01-1.04-.016-2.04-3.338.726-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.729.083-.729 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.807 1.304 3.492.997.107-.775.42-1.304.763-1.604-2.665-.303-5.467-1.332-5.467-5.931 0-1.31.469-2.381 1.236-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 0 1 6 0c2.292-1.552 3.3-1.23 3.3-1.23.652 1.653.241 2.873.118 3.176.768.839 1.235 1.91 1.235 3.22 0 4.61-2.805 5.625-5.476 5.921.431.371.815 1.102.815 2.222 0 1.604-.015 2.896-.015 3.293 0 .319.218.694.825.576A12.001 12.001 0 0 0 12 .5z" clip-rule="evenodd"/>
                </svg>
            </a>
        </div>
    </div>
  </div>

  <!-- Copyright Section -->
  <div class="max-w-7xl mx-auto px-6 py-6 border-t border-slate-300">
    <p class="text-sm text-slate-500 text-center">&copy; 2025 Evently. All rights reserved.</p>
  </div>
</footer>
    <div id="custom-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <div id="modal-icon-container" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                </svg>
            </div>
            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2" id="modal-title">Delete Event</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500" id="modal-body">Are you sure you want to delete this event? This action cannot be undone.</p>
            </div>
            <div class="items-center px-4 py-3" id="modal-footer">
                <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Delete
                </button>
                <button id="modal-cancel-btn" class="px-4 py-2 ml-3 bg-white text-gray-700 text-base font-medium rounded-md w-auto border border-gray-300 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableBody = document.getElementById('events-table-body');
    const welcomeMessage = document.querySelector('h1');
    const totalEventsEl = document.getElementById('total-events-stat');
    const ticketsSoldEl = document.getElementById('tickets-sold-stat');
    const revenueEl = document.getElementById('revenue-stat');
    const sponsorsEl = document.getElementById('sponsors-stat');
    const sponsorshipBadge = document.getElementById('sponsorship-notification-badge');
    let allEvents = [];

    function createEventRow(event) {
        const row = document.createElement('tr');
        row.className = 'hover:bg-slate-50';
        
        const statusColors = {
            'Sponsored': 'bg-green-100 text-green-800',
            'Pending': 'bg-yellow-100 text-yellow-800',
            'No Proposals': 'bg-slate-100 text-slate-800'
        };
        const badgeClass = statusColors[event.sponsor_status] || 'bg-slate-100 text-slate-800';
        const formattedDate = new Date(event.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

        row.innerHTML = `
            <td class="whitespace-nowrap py-4 pl-6 pr-3 text-sm font-medium text-slate-900">${event.title}</td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">${formattedDate}</td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">${event.tickets_sold || 0}</td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">$${parseFloat(event.revenue || 0).toFixed(2)}</td>
            <td class="whitespace-nowrap px-3 py-4 text-sm"><span class="inline-flex items-center rounded-md px-2.5 py-1 text-xs font-semibold ${badgeClass}">${event.sponsor_status}</span></td>
            <td class="whitespace-nowrap px-3 py-4 text-sm font-medium">
                <div class="flex items-center gap-2">
                    <a href="./organizer-view-event.html?id=${event.id}" class="text-blue-600 hover:underline">View</a>
                    <span class="text-slate-300">|</span>
                    <a href="./edit-event.html?id=${event.id}" class="text-blue-600 hover:underline">Edit</a>
                    <span class="text-slate-300">|</span>
                    <button data-event-id="${event.id}" class="delete-btn text-red-600 hover:underline">Delete</button>
                </div>
            </td>
        `;
        return row;
    }

    function updateStatCards() {
        let totalTicketsSold = 0;
        let totalRevenue = 0;
        allEvents.forEach(event => {
            totalTicketsSold += parseInt(event.tickets_sold || 0);
            totalRevenue += parseFloat(event.revenue || 0);
        });
        totalEventsEl.textContent = allEvents.length;
        ticketsSoldEl.textContent = totalTicketsSold.toLocaleString('en-US');
        revenueEl.textContent = `$${totalRevenue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function fetchSponsorshipNotifications() {
        fetch('http://localhost/event-management-backend/sponsorships/get_pending_sponsorships_count.php', { credentials: 'include' })
            .then(response => response.json())
            .then(data => {
                if (data.pending_count > 0) {
                    sponsorshipBadge.textContent = data.pending_count;
                    sponsorshipBadge.classList.remove('hidden');
                } else {
                    sponsorshipBadge.classList.add('hidden');
                }
            })
            .catch(error => console.error('Error fetching sponsorship notifications:', error));
    }

    const apiUrl = 'http://localhost/event-management-backend/events/get_organizer_events.php';
    fetch(apiUrl, { credentials: 'include' })
        .then(response => {
            if (!response.ok) {
                window.location.href = './login-page.html';
                throw new Error('Authentication required.');
            }
            return response.json();
        })
        .then(data => {
            tableBody.innerHTML = '';
            welcomeMessage.textContent = `Welcome back, ${data.organizer_name}`;

            if (data.events && data.events.length > 0) {
                allEvents = data.events;
                allEvents.forEach(event => {
                    tableBody.appendChild(createEventRow(event));
                });
            } else {
                allEvents = [];
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-slate-500">You have not created any events yet.</td></tr>';
            }
            
            updateStatCards();
            sponsorsEl.textContent = data.stats.total_sponsors;
        })
        .catch(error => {
            console.error('Error fetching events:', error);
            tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-500">Could not load events. ${error.message}</td></tr>`;
        });

    // --- Start: Replace the existing tableBody.addEventListener ---

// Get modal elements
const customModal = document.getElementById('custom-modal');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const modalConfirmBtn = document.getElementById('modal-confirm-btn');
const modalCancelBtn = document.getElementById('modal-cancel-btn');
const modalIconContainer = document.getElementById('modal-icon-container');

// Function to show a confirmation modal
function showConfirmationModal(title, body, confirmText, onConfirm) {
    modalTitle.textContent = title;
    modalBody.textContent = body;
    modalConfirmBtn.textContent = confirmText;

    // Reset styles for confirmation
    modalIconContainer.innerHTML = `
        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>`;
    modalIconContainer.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100';
    modalConfirmBtn.className = 'px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500';

    modalConfirmBtn.style.display = '';
    modalCancelBtn.style.display = '';

    customModal.classList.remove('hidden');

    modalConfirmBtn.onclick = function() {
        customModal.classList.add('hidden');
        onConfirm();
    };

    modalCancelBtn.onclick = function() {
        customModal.classList.add('hidden');
    };
}

// Function to show an alert-style modal
function showAlertModal(title, body, isError = false) {
    modalTitle.textContent = title;
    modalBody.textContent = body;

    if (isError) {
        modalIconContainer.innerHTML = `
            <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>`;
        modalIconContainer.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100';
    } else {
        modalIconContainer.innerHTML = `
            <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>`;
        modalIconContainer.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100';
    }

    modalConfirmBtn.textContent = 'OK';
    modalConfirmBtn.className = 'px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500';
    modalConfirmBtn.style.display = '';
    modalCancelBtn.style.display = 'none';

    customModal.classList.remove('hidden');

    modalConfirmBtn.onclick = function() {
        customModal.classList.add('hidden');
    };
}


tableBody.addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('delete-btn')) {
        const button = e.target;
        const eventId = button.dataset.eventId;

        showConfirmationModal(
            'Delete Event',
            'Are you sure you want to delete this event? This action cannot be undone.',
            'Delete',
            () => { // This is the onConfirm callback
                fetch('http://localhost/event-management-backend/events/delete_event.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ event_id: eventId })
                })
                .then(response => response.json().then(data => ({ ok: response.ok, data })))
                .then(({ ok, data }) => {
                    if (!ok) throw new Error(data.error);
                    
                    showAlertModal('Success', data.message);

                    button.closest('tr').remove();
                    allEvents = allEvents.filter(event => event.id != eventId);
                    updateStatCards();
                })
                .catch(error => showAlertModal('Error', error.message, true));
            }
        );
    }
});
// --- End: Replacement code ---

    document.getElementById("createEvent").addEventListener('click', function() {
        window.location.href = "./create-event-page.html";
    });

    // Fetch notifications on page load
    fetchSponsorshipNotifications();
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Find the profile picture element in the header by its ID
        const headerProfilePic = document.getElementById('header-profile-picture');

        // If the element doesn't exist on this page, do nothing.
        if (!headerProfilePic) {
            return;
        }

        // Fetch the user's profile data from the backend
        fetch('http://localhost/event-management-backend/user/get_profile.php', {
            credentials: 'include' // Important for sending session cookies
        })
        .then(response => {
            // If the user is not logged in, the response will not be 'ok'
            if (!response.ok) {
                throw new Error('User not logged in or session expired');
            }
            return response.json();
        })
        .then(data => {
            // Check if the user data contains a path to a profile photo
            if (data && data.profile_photo_path) {
                // Construct the full URL to the photo and update the image source
                const photoUrl = `http://localhost/event-management-backend/${data.profile_photo_path}`;
                headerProfilePic.src = photoUrl;
            }
            // If no photo path exists, the default placeholder image will remain.
        })
        .catch(error => {
            // This error is expected on pages where the user isn't logged in.
            // We can log it for debugging but won't show an alert.
            console.log('Profile picture loader:', error.message);
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Find the profile picture element in the header by its unique ID
        const headerProfilePic = document.getElementById('header-profile-picture');

        // If this page doesn't have the profile picture element, do nothing.
        if (!headerProfilePic) {
            return;
        }

        // Fetch the user's profile data from the backend
        fetch('http://localhost/event-management-backend/user/get_profile.php', {
            credentials: 'include' // Important for sending session cookies
        })
        .then(response => {
            // If the user is not logged in, the response will not be 'ok'
            if (!response.ok) {
                throw new Error('User not logged in or session expired');
            }
            return response.json();
        })
        .then(data => {
            // Check if the user data contains a path to a profile photo
            if (data && data.profile_photo_path) {
                // Construct the full, correct URL to the photo
                const photoUrl = `http://localhost/event-management-backend/${data.profile_photo_path}`;
                // Update the image source to display the user's picture
                headerProfilePic.src = photoUrl;
            }
            // If no photo path exists, the default placeholder image will simply remain.
        })
        .catch(error => {
            // This error is normal on pages where a user isn't logged in.
            // We can log it for debugging but won't show a disruptive alert.
            console.log('Profile picture loader:', error.message);
        });
    });
</script>

</body>
</html>