<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Events - Evently</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://rsms.me/inter/inter.css');
        html { font-family: 'Inter', sans-serif; }
        .favorite-btn.favorited svg {
            fill: #ef4444; /* red-500 */
            color: #ef4444; /* red-500 */
        }
    </style>
</head>

<body class="bg-white">

    <header class="bg-white border-b border-slate-200">
        <div class="mx-auto flex h-20 max-w-7xl items-center justify-between px-6 lg:px-8">
            <div class="flex items-center gap-12">
                <a href="./ticket-buyer-dashboard.html" class="flex items-center space-x-2" id="logo-link">
                    <svg class="h-7 w-7 text-gray-800" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <span class="text-xl font-bold text-gray-900">Evently</span>
                </a>
                <nav class="hidden items-center gap-8 md:flex">
                    <a href="./ticket-buyer-dashboard.html" class="text-sm font-semibold text-blue-600">Explore</a>
                    <a href="./view-ticket.html" class="text-sm font-medium text-slate-600 hover:text-slate-900">Your
                        Ticket</a>
                    <a href="./ticket-buyer-dashboard.html" class="text-sm font-medium text-slate-600 hover:text-slate-900" id="return-to-dashboard"></a>
                </nav>
            </div>
            <div class="flex items-center gap-5">
                <a href="../general/profile.html">
    <img id="header-profile-picture" 
         class="h-9 w-9 rounded-full object-cover" 
         src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2EwYTBiMyI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgM2MxLjY2IDAgMyAxLjM0IDMgMyAwIDEuNjYtMS4zNCAzLTMgMy0xLjY2IDAtMy0xLjM0LTMtMyAwLTEuNjYgMS4zNC0zIDMtM3ptMCAxNC4yYy0yLjUgMC00LjcxLTEuMjgtNi0zLjIyLjAzLTEuOTkgNC0zLjA4IDYtMy4wOHM1Ljk3IDEuMDkgNiAzLjA4Yy0xLjI5IDEuOTQtMy41IDMuMjItNiAzLjIyeiIvPjwvc3ZnPg==" 
         alt="User avatar" />
</a>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl px-6 py-10 lg:px-8">
        <div class="relative">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
            </div>
            <input type="search" id="search-input" class="block w-full rounded-lg border-0 bg-slate-100 py-4 pl-12 pr-4 text-slate-900 placeholder:text-slate-500 focus:ring-2 focus:ring-blue-500" placeholder="Search for events by title or location">
        </div>

        <div class="mt-8 grid grid-cols-1 gap-8 md:grid-cols-3">
            <div class="group transform cursor-pointer transition-transform duration-300 hover:-translate-y-1">
                <img class="w-full h-48 rounded-lg object-cover" src="https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?auto=format&fit=crop&w=1170&q=80" alt="Live Music Festival">
                <div class="mt-4">
                    <h3 class="text-lg font-bold text-slate-900">Live Music Festival</h3>
                    <p class="mt-1 text-sm text-slate-600">Experience the energy of live music with top artists.</p>
                </div>
            </div>
            <div class="group transform cursor-pointer transition-transform duration-300 hover:-translate-y-1">
                <img class="w-full h-48 rounded-lg object-cover" src="https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?auto=format&fit=crop&w=1170&q=80" alt="Modern Art Exhibition">
                <div class="mt-4">
                    <h3 class="text-lg font-bold text-slate-900">Modern Art Exhibition</h3>
                    <p class="mt-1 text-sm text-slate-600">Explore a diverse collection of contemporary art.</p>
                </div>
            </div>
            <div class="group transform cursor-pointer transition-transform duration-300 hover:-translate-y-1">
                <img class="w-full h-48 rounded-lg object-cover" src="https://images.unsplash.com/photo-1579952363873-27f3bade9f55?auto=format&fit=crop&w=735&q=80" alt="Professional Sports Game">
                <div class="mt-4">
                    <h3 class="text-lg font-bold text-slate-900">Professional Sports Game</h3>
                    <p class="mt-1 text-sm text-slate-600">Cheer for your favorite team in a thrilling match.</p>
                </div>
            </div>
        </div>

        <section class="mt-12">
            <div class="flex w-max items-center gap-2 rounded-lg bg-slate-100 p-1" id="event-tabs">
                <button data-tab="upcoming" class="event-tab rounded-md bg-slate-800 px-4 py-2 text-sm font-semibold text-white shadow transition">Upcoming Events</button>
                <button data-tab="past" class="event-tab rounded-md px-4 py-2 text-sm font-semibold text-slate-600 transition hover:bg-slate-200">Past Events</button>
                <button data-tab="favorite" class="event-tab rounded-md px-4 py-2 text-sm font-semibold text-slate-600 transition hover:bg-slate-200">Favorite Events</button>
            </div>

            <div class="mt-8 space-y-10" id="event-list-container"></div>
        </section>
    </main>
    <footer class="bg-slate-100 text-slate-700">
  <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 md:grid-cols-4 gap-8">

    <!-- Branding -->
    <div>
      <h2 class="text-xl font-bold text-slate-900 mb-2">Evently</h2>
      <p class="text-sm">Connecting you to events that matter.</p>
    </div>

    <!-- Contact Information -->
    <div>
      <h3 class="text-sm font-semibold text-slate-900 mb-2">Contact</h3>
      <p class="text-sm">üìß support@evently.com</p>
      <p class="text-sm">üìû +91 98765 43210</p>
      <p class="text-sm">üìç Mumbai, India</p>
    </div>

    <!-- Event Categories -->
    <div>
      <h3 class="text-sm font-semibold text-slate-900 mb-2">Know More About Us</h3>
      <ul class="space-y-1 text-sm">
        <li><a href="#" class="hover:text-blue-600">Privacy Policy</a></li>
        <li><a href="#" class="hover:text-blue-600">Terms & Conditions</a></li>
        <li><a href="#" class="hover:text-blue-600">Cookie Policy</a></li>
      </ul>
    </div>

    <!-- Our Socials (Moved from below) -->
    <div>
        <h3 class="text-sm font-semibold text-slate-900 mb-2">Our Socials</h3>
        <div class="flex space-x-4">
            <!-- Facebook -->
            <a href="#" class="hover:text-blue-600">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.877v-6.987h-2.54v-2.89h2.54V9.845c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.242 0-1.63.771-1.63 1.562v1.875h2.773l-.443 2.89h-2.33v6.987C18.343 21.128 22 16.991 22 12z"/>
                </svg>
            </a>
            <!-- Instagram -->
            <a href="#" class="hover:text-pink-500">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5a4.25 4.25 0 0 0 4.25-4.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5zm8.75 2a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z"/>
                </svg>
            </a>
            <!-- LinkedIn -->
            <a href="#" class="hover:text-blue-700">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20.447 20.452H16.89v-5.568c0-1.327-.027-3.036-1.85-3.036-1.851 0-2.136 1.445-2.136 2.939v5.665H9.348V9h3.409v1.561h.048c.476-.9 1.637-1.85 3.37-1.85 3.6 0 4.267 2.369 4.267 5.455v6.286zM5.337 7.433a1.992 1.992 0 1 1 0-3.984 1.992 1.992 0 0 1 0 3.984zM6.896 20.452H3.778V9h3.118v11.452z"/>
                </svg>
            </a>
            <!-- GitHub -->
            <a href="#" class="hover:text-gray-800">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 .5a12 12 0 0 0-3.792 23.39c.6.113.82-.26.82-.577 0-.285-.01-1.04-.016-2.04-3.338.726-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.729.083-.729 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.807 1.304 3.492.997.107-.775.42-1.304.763-1.604-2.665-.303-5.467-1.332-5.467-5.931 0-1.31.469-2.381 1.236-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 0 1 6 0c2.292-1.552 3.3-1.23 3.3-1.23.652 1.653.241 2.873.118 3.176.768.839 1.235 1.91 1.235 3.22 0 4.61-2.805 5.625-5.476 5.921.431.371.815 1.102.815 2.222 0 1.604-.015 2.896-.015 3.293 0 .319.218.694.825.576A12.001 12.001 0 0 0 12 .5z" clip-rule="evenodd"/>
                </svg>
            </a>
        </div>
    </div>
  </div>

  <!-- Copyright Section -->
  <div class="max-w-7xl mx-auto px-6 py-6 border-t border-slate-300">
    <p class="text-sm text-slate-500 text-center">&copy; 2025 Evently. All rights reserved.</p>
  </div>
</footer>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- NEW SCRIPT TO HANDLE DYNAMIC LOGO LINK BASED ON ROLE ---
    const logoLink = document.getElementById('logo-link');
    const return_to_dashboard = document.getElementById('return-to-dashboard');

    fetch('http://localhost/event-management-backend/user/get_profile.php', { credentials: 'include' })
        .then(response => response.json())
        .then(user => {
            if (user.role === 'organizer') {
                logoLink.href = '../organizer/organizer-dashboard.html';
                return_to_dashboard.textContent = "Return to Organizer"
                return_to_dashboard.href = "../organizer/organizer-dashboard.html";
            } else if (user.role === 'sponsor') {
                logoLink.href = '../sponsor/sponsor-dashboard.html';
                return_to_dashboard.textContent = "Return to Sponsor"
                return_to_dashboard.href = "../sponsor/sponsor-dashboard.html";
            }
            // If the role is 'ticket_buyer', the default link is already correct.
        })
        .catch(err => console.log('User not logged in or session error.'));
    // --- END OF NEW SCRIPT ---
    
    // The rest of the page script for fetching events remains the same...
    const tabs = document.querySelectorAll('.event-tab');
    const eventListContainer = document.getElementById('event-list-container');
    const searchInput = document.getElementById('search-input');
    let allFetchedEvents = [];
    let currentTab = 'upcoming';
    let searchTerm = '';
    let debounceTimer;

    function fetchAndRenderEvents() {
        const fetchFilter = currentTab === 'favorite' ? '' : currentTab;
        const url = `http://localhost/event-management-backend/events/get_dashboard_events.php?filter=${fetchFilter}&search=${encodeURIComponent(searchTerm)}`;
        fetch(url, { credentials: 'include' })
            .then(response => response.json())
            .then(data => {
                allFetchedEvents = data;
                renderEvents();
            })
            .catch(error => {
                console.error('Failed to load events:', error);
                eventListContainer.innerHTML = '<p class="text-red-600">Failed to load events.</p>';
            });
    }

    function renderEvents() {
        eventListContainer.innerHTML = '';
        let eventsToRender = allFetchedEvents;
        if (currentTab === 'favorite') {
            eventsToRender = allFetchedEvents.filter(event => event.is_favorited);
        }
        if (eventsToRender.length === 0) {
            eventListContainer.innerHTML = `<p class="text-slate-500">No ${currentTab} events found.</p>`;
            return;
        }
        eventsToRender.forEach(event => {
            eventListContainer.innerHTML += createEventHTML(event);
        });
    }

    function createEventHTML(event) {
        const eventDate = new Date(event.date);
        const details = `${event.location} | ${eventDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
        const imageUrl = event.banner_image ? `http://localhost/event-management-backend/${event.banner_image}` : 'https://placehold.co/600x400/e2e8f0/64748b?text=Event';
        const favoritedClass = event.is_favorited ? 'favorited' : '';
        return `
            <div class="grid grid-cols-1 items-center gap-8 lg:grid-cols-3 animate-fade-in">
                <div class="lg:col-span-2">
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-medium text-indigo-600">${event.category || 'General'}</p>
                        <button class="favorite-btn p-2 rounded-full hover:bg-red-50 ${favoritedClass}" data-event-id="${event.id}">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>
                        </button>
                    </div>
                    <h3 class="mt-1 text-2xl font-bold text-slate-900">${event.title}</h3>
                    <p class="mt-1 text-sm text-slate-500">${details}</p>
                    <a href="event-info.html?id=${event.id}" class="mt-4 inline-block rounded-md bg-slate-100 px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-200">View Details</a>
                </div>
                <div class="order-first lg:order-last">
                    <img class="h-56 w-full rounded-lg object-cover" src="${imageUrl}" alt="${event.title}">
                </div>
            </div>
        `;
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
            currentTab = e.currentTarget.dataset.tab;
            tabs.forEach(t => {
                t.classList.remove('bg-slate-800', 'text-white', 'shadow');
                t.classList.add('text-slate-600', 'hover:bg-slate-200');
            });
            e.currentTarget.classList.add('bg-slate-800', 'text-white', 'shadow');
            e.currentTarget.classList.remove('text-slate-600', 'hover:bg-slate-200');
            fetchAndRenderEvents();
        });
    });
    searchInput.addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            searchTerm = e.target.value;
            fetchAndRenderEvents();
        }, 300);
    });
    eventListContainer.addEventListener('click', function(e) {
        const favoriteBtn = e.target.closest('.favorite-btn');
        if (favoriteBtn) {
            const eventId = favoriteBtn.dataset.eventId;
            toggleFavorite(eventId, favoriteBtn);
        }
    });
    function toggleFavorite(eventId, button) {
        fetch('http://localhost/event-management-backend/favorites/toggle_favorite.php', {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ event_id: eventId })
        })
        .then(response => {
            if (response.status === 401) { alert('Please log in to favorite events.'); throw new Error('Unauthorized'); }
            return response.json();
        })
        .then(data => {
            button.classList.toggle('favorited', data.status === 'added');
            const event = allFetchedEvents.find(e => e.id == eventId);
            if (event) { event.is_favorited = (data.status === 'added'); }
            if (currentTab === 'favorite') { renderEvents(); }
        })
        .catch(error => {
            if (error.message !== 'Unauthorized') { console.error('Error toggling favorite:', error); }
        });
    }
    fetchAndRenderEvents();
    const style = document.createElement('style');
    style.innerHTML = `@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }`;
    document.head.appendChild(style);
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Find the profile picture element in the header by its ID
        const headerProfilePic = document.getElementById('header-profile-picture');

        // If the element doesn't exist on this page, do nothing.
        if (!headerProfilePic) {
            return;
        }

        // Fetch the user's profile data from the backend
        fetch('http://localhost/event-management-backend/user/get_profile.php', {
            credentials: 'include' // Important for sending session cookies
        })
        .then(response => {
            // If the user is not logged in, the response will not be 'ok'
            if (!response.ok) {
                throw new Error('User not logged in or session expired');
            }
            return response.json();
        })
        .then(data => {
            // Check if the user data contains a path to a profile photo
            if (data && data.profile_photo_path) {
                // Construct the full URL to the photo and update the image source
                const photoUrl = `http://localhost/event-management-backend/${data.profile_photo_path}`;
                headerProfilePic.src = photoUrl;
            }
            // If no photo path exists, the default placeholder image will remain.
        })
        .catch(error => {
            // This error is expected on pages where the user isn't logged in.
            // We can log it for debugging but won't show an alert.
            console.log('Profile picture loader:', error.message);
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Find the profile picture element in the header by its unique ID
        const headerProfilePic = document.getElementById('header-profile-picture');

        // If this page doesn't have the profile picture element, do nothing.
        if (!headerProfilePic) {
            return;
        }

        // Fetch the user's profile data from the backend
        fetch('http://localhost/event-management-backend/user/get_profile.php', {
            credentials: 'include' // Important for sending session cookies
        })
        .then(response => {
            // If the user is not logged in, the response will not be 'ok'
            if (!response.ok) {
                throw new Error('User not logged in or session expired');
            }
            return response.json();
        })
        .then(data => {
            // Check if the user data contains a path to a profile photo
            if (data && data.profile_photo_path) {
                // Construct the full, correct URL to the photo
                const photoUrl = `http://localhost/event-management-backend/${data.profile_photo_path}`;
                // Update the image source to display the user's picture
                headerProfilePic.src = photoUrl;
            }
            // If no photo path exists, the default placeholder image will simply remain.
        })
        .catch(error => {
            // This error is normal on pages where a user isn't logged in.
            // We can log it for debugging but won't show a disruptive alert.
            console.log('Profile picture loader:', error.message);
        });
    });
</script>
</body>

</html>